define([
  "dojo/_base/declare"
  , "dijit/layout/ContentPane"
  , "main/contentIO"
  , "client/types/Directory"
  , "dojo/_base/lang"
  , "sol/fileName"
  , "sol/wgt/CodeMirror"
], function(
  declare
  , ContentPane
  , contentIO
  , Directory
  , lang
  , fileName
  , CodeMirror
){
  return declare([
    ContentPane
  ], {
    item: {} // will be provided
    , closable: true
    , postMixInProperties: function(){
      this.inherited(arguments);
      this.title = fileName.single(this.item.name || this.item.id);
    }
    , startup: function(){
      if (this._started) { return; };
      this.inherited(arguments);
      contentIO.getContentDef(this.item.id).then(lang.hitch(this, function(res){
        if (res.contentType == "inode/directory"){
          var d = new Directory({
            content: res
            , contentObj: this
          });
          d.placeAt(this.domNode);
          d.startup();
          this.own(d);
          this.resize();
        }else if(res.isText){
          var t = new CodeMirror({
            value: res.text
          });
          t.placeAt(this.domNode);
          t.startup();
          this.own(t);
          this.resize();
        };
      }));
    }
    
    , removeMe: function(){}
    
    , onClose: function(){
      this.removeMe();
      return true;
    }
    /*, destroy: function(){
      debugger;
      this.inherited(arguments);
    }
    , destroyRecursive: function(){
      debugger;
      this.inherited(arguments);
    }*/
  });
});
